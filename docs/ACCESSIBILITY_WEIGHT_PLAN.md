# AI 모델 신뢰도 기반 재검토 필요성 분석 계획

## 📋 목적
`gt.jsonl` 데이터를 분석하여 AI 모델의 예측 신뢰도(confidence)를 기반으로 재검토/재레이블링이 필요한 이미지를 식별한다.

## 🎯 핵심 개념

**모델 신뢰도 (Confidence Score)**
- 높은 신뢰도 (예: 90% 이상) → AI 예측을 신뢰 → **재검토 불필요**
- 낮은 신뢰도 (예: 75% 미만) → AI 예측 불확실 → **재검토 필요**

**재검토 필요 여부 = 1 - 모델 신뢰도**
- 신뢰도가 높을수록 재검토 필요성 낮음
- 신뢰도가 낮을수록 재검토 필요성 높음

## 🔍 현재 점수 계산 방식 (Frontend)

```javascript
기본 점수: 100점
- 단차 (has_step): -30점
- 통로 너비:
  - not_passable: -40점
  - narrow: -20점
  - normal: -10점
- 의자: 이동형이 없으면 -10점
```

## 📊 이동약자 관점 중요도 분석

### 1. 단차 (계단/턱) - 🚨 최우선 중요도
**이동약자에게 미치는 영향:**
- 휠체어 사용자: **완전 차단** (혼자서 이동 불가능)
- 목발/지팡이 사용자: **위험 요소** (낙상 위험)
- 보조기 사용자: **진입 어려움**

**현재 가중치:** -30점
**제안 가중치:** -40 ~ -50점 (더 높은 페널티 필요)

### 2. 통로 너비 - 🚨 최우선 중요도
**이동약자에게 미치는 영향:**
- not_passable: 휠체어 통과 **완전 불가능** → 접근 불가
- narrow: 휠체어 통과 **극도로 어려움** → 실질적 접근 불가
- normal: 휠체어 통과 가능하나 **불편함**
- wide: 휠체어 통과 **쾌적함**

**현재 가중치:**
- not_passable: -40점
- narrow: -20점
- normal: -10점

**제안 가중치:**
- not_passable: -50 ~ -60점 (접근 불가)
- narrow: -30 ~ -35점 (실질적 접근 불가)
- normal: -10 ~ -15점 (불편하나 가능)
- wide: 0점 (감점 없음)

### 3. 의자 타입 - ⚠️ 중요도 중상
**이동약자에게 미치는 영향:**
- 이동형 의자 (movable): 휠체어에서 이동 가능 → **접근성 우수**
- 높이 조절 가능 의자 (high_movable): 다양한 신장에 대응 → **접근성 우수**
- 고정형 의자 (fixed): 위치 조절 불가 → **접근성 저하**
- 좌식형 의자 (floor): 휠체어 사용자에게 **접근 불가능**

**현재 가중치:** 이동형 없으면 -10점 (단순)
**제안 가중치:** 세분화 필요
- 좌식형 의자만 있으면: -30점 (휠체어 접근 불가)
- 고정형 의자만 있으면: -15점 (위치 조절 불가)
- 이동형 의자 있으면: 0점 (감점 없음)
- 높이 조절 가능: +5점 보너스 (가산점)

## 📈 데이터 분석 계획

### Phase 1: 데이터 분석 및 통계 산출
1. **gt.jsonl 전체 데이터 분석**
   - 총 이미지 수
   - 각 클래스별 분포
     - has_step: true/false 비율
     - width_class: wide/normal/narrow/not_passable 비율
     - chair 타입별 비율
   - 현재 점수 분포
     - S/A/B/C/D 등급별 비율
     - 평균 점수

2. **조합별 분석**
   - 단차 + 통로 너비 조합별 점수 분포
   - 단차 + 의자 타입 조합별 점수 분포
   - 통로 너비 + 의자 타입 조합별 점수 분포
   - 3가지 요소 모두 조합한 경우별 분석

3. **이동약자 관점 영향도 분석**
   - 각 요소가 실제 접근성에 미치는 영향도 계산
   - 조합 시 영향도 증폭 분석

### Phase 2: 가중치 재설정 제안

#### 시나리오 1: 보수적 접근 (현재 구조 유지)
```
기본 점수: 100점
- 단차: -40점 (기존 -30점에서 증가)
- 통로:
  - not_passable: -50점 (기존 -40점에서 증가)
  - narrow: -30점 (기존 -20점에서 증가)
  - normal: -10점 (유지)
  - wide: 0점 (유지)
- 의자:
  - 좌식형만: -30점 (신규)
  - 고정형만: -15점 (신규)
  - 이동형 있음: 0점 (유지)
  - 높이 조절 가능: +5점 (신규 보너스)
```

#### 시나리오 2: 현실적 접근 (더 정교한 가중치)
```
기본 점수: 100점
- 단차: -45점
- 통로:
  - not_passable: -60점 (접근 불가)
  - narrow: -35점 (실질적 접근 불가)
  - normal: -12점
  - wide: 0점
- 의자:
  - 좌식형만: -35점
  - 고정형만: -18점
  - 이동형 있음: 0점
  - 높이 조절 가능: +3점
```

#### 시나리오 3: 엄격한 접근 (접근성 우선)
```
기본 점수: 100점
- 단차: -50점
- 통로:
  - not_passable: -70점
  - narrow: -40점
  - normal: -15점
  - wide: 0점
- 의자:
  - 좌식형만: -40점
  - 고정형만: -20점
  - 이동형 있음: 0점
  - 높이 조절 가능: +5점
```

### Phase 3: 검증 및 비교

1. **기존 가중치 vs 새로운 가중치 비교**
   - 전체 데이터셋 점수 재계산
   - 등급 분포 변화 분석
   - 평균 점수 변화 분석

2. **이동약자 관점 검증**
   - 실제 이동약자 사용 사례와 비교
   - 전문가 의견 반영 가능 여부 검토

3. **A/B 테스트 설계**
   - 기존 가중치와 새 가중치 비교
   - 필터링 결과 차이 분석

### Phase 4: 구현 및 적용

1. **코드 수정**
   - `calculateAccessibilityScore` 함수 업데이트
   - Frontend: `frontend/src/services/api.js`
   - Backend: `backend/processor/data_manager.py`
   - ImageModal 컴포넌트의 점수 계산 함수도 업데이트

2. **데이터 마이그레이션**
   - 기존 계산된 점수와 새 점수 비교 표시
   - 점수 변경 히스토리 기록

3. **UI 업데이트**
   - 점수 계산 로직 설명 추가
   - 가중치 기준 명시

## 📝 분석 스크립트 계획

### 분석 스크립트 구성
1. **데이터 로더**
   - `gt.jsonl` 파일 읽기
   - JSON 파싱

2. **통계 계산기**
   - 클래스별 분포 계산
   - 조합별 분석
   - 현재 점수 분포

3. **가중치 시뮬레이터**
   - 여러 시나리오 점수 재계산
   - 등급 분포 변화 분석
   - 비교 리포트 생성

4. **시각화**
   - 현재 점수 vs 새 점수 분포 비교 차트
   - 등급 변화 막대 그래프
   - 조합별 영향도 히트맵

## 🎯 우선순위

### High Priority
1. ✅ `gt.jsonl` 전체 데이터 분석 및 통계 산출
2. ✅ 현재 점수 계산 로직 검토
3. ✅ 이동약자 관점 영향도 분석

### Medium Priority
1. 여러 가중치 시나리오 제안 및 비교
2. 검증 및 비교 분석
3. 최종 가중치 결정

### Low Priority
1. 구현 및 적용
2. UI 업데이트
3. 문서화

## 🔧 구현 파일 목록

- `scripts/analyze_accessibility_weights.py` - 분석 스크립트 (신규 생성)
- `scripts/weight_scenarios.json` - 가중치 시나리오 설정 (신규 생성)
- `frontend/src/services/api.js` - 점수 계산 함수 수정
- `backend/processor/data_manager.py` - 점수 계산 함수 수정
- `frontend/src/components/ImageModal.jsx` - 점수 계산 함수 수정

## 📚 참고 자료

- 한국 장애인 접근성 기준
- WCAG 2.1 접근성 가이드라인
- 휠체어 사용자 공간 접근성 기준

